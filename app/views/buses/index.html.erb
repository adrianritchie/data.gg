<% content_for :breadcrumb do %>
  <ol class="breadcrumb">
    <li><%= link_to "Home", root_path %></li>
    <li class="active">Buses</li>
  </ol>
<% end %>

<h2>Bus Data</h2>

<table class="table table-striped" style="margin-bottom:50px">
  <thead>
    <tr>
      <th>URL Format</th>
      <th>Description</th>
      <th>XML</th>
      <th>JSON</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="white-space:nowrap">http://www.data.gg/api/1.0/buses/timetables/current_version.{format}</td>
      <td>Outputs XML containing the current timetable date and version</td>
      <td><%= link_to 'XML', api_v10_buses_timetables_current_version_path(:format => :xml) %></td>
      <td><%= link_to 'JSON', api_v10_buses_timetables_current_version_path(:format => :json) %></td>
    </tr>
    <tr>
      <td style="white-space:nowrap">http://www.data.gg/api/1.0/buses/timetables/list.{format}</td>
      <td>Outputs a list of timetables without timetable data</td>
      <td><%= link_to 'XML', api_v10_buses_timetables_list_path(:format => :xml) %></td>
      <td><%= link_to 'JSON', api_v10_buses_timetables_list_path(:format => :json) %></td>
    </tr>
    <tr>
      <td style="white-space:nowrap">http://www.data.gg/data/transport/buses/{yyyy-mm-dd}_{revision}.{format}</td>
      <td>Outputs <em>all</em> timetable data for the specified timetable. Note, all URLs starting with 'data' are static dumps.</td>
      <td colspan="4" align="center"><em>(see below for direct links)</em></td>
    </tr>                                                                       
  </tbody>
</table>

<h3>Timetables</h3>
<%= form_for [:buses, @timetable], { :class => 'form-inline'} do |f| %>
<table class="table table-striped" style="width:100%">
  <% if @timetables.count > 0 %>
  <thead>
    <tr>
      <th>Name</th>
      <th>Start Date</th>
      <th>End Date</th>
      <th>XML</th>
      <th>JSON</th>
    </tr>
  </thead>
  <% end %>
  <tbody>
    <% if @timetables.count > 0 %>
      <% @timetables.each do |timetable| %>
        <tr>
          <td style="vertical-align:middle"><%= link_to timetable.name, buses_timetable_path(:start_date => timetable.start_date) %></td>
          <td style="vertical-align:middle"><%= timetable.start_date %></td>
          <td style="vertical-align:middle"><%= timetable.end_date %></td>
          <td style="vertical-align:middle">
              <%= link_to "XML", timetable.xml_download_url %>
              <%= link_to "[compressed]", timetable.xml_download_url_compressed %>
          </td>
          <td style="vertical-align:middle">
            <%= link_to "JSON", timetable.json_download_url %>
            <%= link_to "[compressed]", timetable.json_download_url_compressed %>
          </td>
        </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="4"><h3 class="text-center">Uh-oh, no timetables available yet!</h3></td>
      </tr>
    <% end %>
  </tbody>
  
  <% if user_signed_in? %>
  <tfoot>
    <tr>
      <td><%= f.text_field :name, {:tabindex => 1, :autofocus => true, :class => "form-control", :placeholder => "Name"} %></td>
      <td><%= f.text_field :start_date, {:tabindex => 2, :class => "form-control", :placeholder => "Start date" } %></td>
      <td><%= f.text_field :end_date, {:tabindex => 3, :class => "form-control", :placeholder => "End date" } %></td>
      <td colspan="6"><%= f.submit 'Create', { :class => "btn btn-primary"} %></td>
    </tr>
  </tfoot>
  <% end %>
</table>
<% end %>